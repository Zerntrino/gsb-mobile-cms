<div class="flex flex-col h-full">
  <div class="flex items-center my-2 space-x-4">
    <div class="flex-1">
      <app-nav title="ตั้งค่า" [items]="navItems" class=""></app-nav>
    </div>
  </div>

  <div class="flex-1 mx-w my-2 bg-white">
    <div class="py-4 px-6">
      <app-tab [tabs]="tabs" [index]="tab" (tabChange)="tab = $event"></app-tab>
    </div>

    <div *ngIf="tab == 0">
      <div class="pb-4 px-6 flex space-x-4">
        <div class="flex-1 flex relative">
          <img
            src="assets/icons/search.svg"
            class="mx-auto w-6 absolute top-2 left-2"
            alt=""
          />
          <input
            class="input max-w-md pl-10"
            [(ngModel)]="qMcc"
            placeholder="ค้นหา: MCC"
            (ngModelChange)="qMccChange()"
          />
        </div>

        <div class="flex items-center space-x-2">
          <div>สถานะ</div>
          <select2
            class="w-44"
            [value]="statusMcc"
            (update)="statusMccChange($event)"
            [data]="statusMccOption"
            placeholder="สถานะ"
          ></select2>
        </div>
      </div>

      <div class="px-6 table w-full">
        <div class="table-header-group">
          <div class="table-row">
            <div class="table-cell text-center">#</div>
            <div class="table-cell">ประเภทบัตร</div>
            <div class="table-cell">MCC Code</div>
            <div class="table-cell">เพิ่มรายการ</div>
          </div>
        </div>
        <div class="table-row-group">
          <div class="table-row" *ngFor="let item of listMcc; let i = index">
            <div class="table-cell text-center">
              {{ i + 1 }}
            </div>
            <div class="table-cell">{{ item.cardName }}</div>
            <div class="table-cell">
              <div class="flex flex-wrap -m-1">
                <div
                  class="bg-pink-100 px-2 py-1 rounded-md m-1"
                  *ngFor="let code of item.mccCode"
                >
                  {{ getMccName(code) }}
                </div>
              </div>
            </div>

            <div class="table-cell">
              <button
                class="button-dark text-sm w-20 px-3 py-2"
                (click)="show(item)"
              >
                + MCC
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div *ngIf="tab == 1">
      <div class="pb-4 px-6 flex space-x-4">
        <div class="flex-1 flex relative"></div>

        <div class="flex items-center space-x-2">
          <div>สถานะ</div>
          <select2
            class="w-44"
            [value]="statusMinimum"
            (update)="statusMinimumChange($event)"
            [data]="statusMinimumOption"
            placeholder="สถานะ"
          ></select2>
        </div>
      </div>

      <div class="px-6 table w-full">
        <div class="table-header-group">
          <div class="table-row">
            <div class="table-cell text-center">#</div>
            <div class="table-cell">ประเภทบัตร</div>
            <div class="table-cell text-right">
              ยอดใช้จ่ายขั้นต่ำ (ต่อเซลล์สลิป)
            </div>
            <div class="table-cell text-right">คำสั่ง</div>
          </div>
        </div>
        <div class="table-row-group">
          <div
            class="table-row"
            *ngFor="let item of listMinimum; let i = index"
          >
            <div class="table-cell text-center">
              {{ i + 1 }}
            </div>
            <div class="table-cell">{{ item.cardName }}</div>
            <div class="table-cell">
              <div class="flex justify-end">
                <input
                  class="input max-w-sm text-right ml-auto"
                  placeholder="ยอดใช้จ่ายขั้นต่ำ"
                  [disabled]="!item.isEditing"
                  [(ngModel)]="item.minimumAmount"
                />
              </div>
            </div>
            <div class="table-cell">
              <div class="space-x-2 justify-end flex">
                <button
                  *ngIf="!item.isEditing"
                  (click)="editMinimum(item)"
                  class="button-border text-sm w-20 px-3 py-2"
                >
                  แก้ไข
                </button>
                <button
                  *ngIf="item.isEditing"
                  (click)="
                    item.minimumAmount = item.oldMinimumAmount || 0;
                    item.isEditing = false
                  "
                  class="button-default-border text-sm w-20 px-3 py-2"
                >
                  ยกเลิก
                </button>
                <button
                  *ngIf="item.isEditing"
                  (click)="item.isEditing = false"
                  class="button text-sm w-20 px-3 py-2"
                >
                  บันทึก
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- modal -->
  <div class="relative z-10 transition-all" [hidden]="showType == 'hide'">
    <div
      class="fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity"
    ></div>

    <div
      class="fixed inset-0 z-10 w-screen overflow-y-auto flex items-center justify-center"
    >
      <div class="w-full max-w-xl bg-white rounded-md overflow-hidden">
        <div class="flex items-center border-b border-gray-100">
          <div class="flex-1 py-4 px-6 font-semibold">MCC (ห้ามผ่อนชำระ)</div>
        </div>

        <div class="px-6 py-4">
          <div class="mb-4 font-semibold">
            ประเภทบัตร : <span class="text-primary">{{ mcc.cardName }}</span>
          </div>

          <div class="flex relative">
            <!-- <img
              src="assets/icons/search.svg"
              class="mx-auto w-6 absolute top-2 left-2"
              alt=""
            />
            <input
              class="input w-full pl-10"
              [(ngModel)]="qAddMcc"
              placeholder="ค้นหา: MCC"
              (ngModelChange)="qAddMccChange()"
            /> -->
            <select2
              class="w-full"
              [value]="addMcc"
              (update)="addMccChange($event)"
              [data]="currentAddMccOption"
              placeholder="ค้นหา: MCC"
              [resettable]="true"
            ></select2>
          </div>
        </div>

        <div class="px-6 table w-full">
          <div class="table-header-group">
            <div class="table-row">
              <div class="table-cell text-center">#</div>
              <div class="table-cell">MCC (ห้ามผ่อนชำระ)</div>
              <div class="table-cell">ลบ</div>
            </div>
          </div>
          <div class="table-row-group">
            <div
              class="table-row"
              *ngFor="let item of mcc.mccCode; let i = index"
            >
              <div class="table-cell text-center">
                {{ i + 1 }}
              </div>
              <div class="table-cell">
                <span class="pl-2">{{ getMccName(item) }}</span>
              </div>
              <div class="table-cell">
                <img
                  src="assets/icons/remove.svg"
                  class="w-6"
                  alt=""
                  class="cursor-pointer"
                  (click)="remove(item)"
                />
              </div>
            </div>
          </div>
        </div>

        <div
          class="mt-6 px-4 py-4 flex justify-end space-x-4 border-t border-gray-100"
        >
          <button class="button-default-border" (click)="showType = 'hide'">
            ยกเลิก
          </button>
          <button class="button" (click)="confirm()">บันทึก</button>
        </div>
      </div>
    </div>
  </div>

  <div
    class="sticky bottom-0 px-6 py-6 box-shadow-bottom bg-white flex justify-end space-x-4 -mx-4 -my-2"
  >
    <a routerLink="/parameter"
      ><button class="button-default-border w-auto px-6">ยกเลิก</button></a
    >
    <button class="button w-auto px-6" (click)="save()">
      {{ tab == 0 ? "บันทึก MCC" : "บันทึกยอดใช้จ่ายขั้นต่ำ" }}
    </button>
  </div>
</div>
